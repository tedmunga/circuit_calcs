<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Circuit Diagram Builder</title>
<!--
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
-->
  <script src="lib/p5.min.js"></script>
  <script src='lib/MathJax-2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
  <script>MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\\(', '\\)']] }, displayAlign: "left", processEscapes: true })</script>
  <script src="js/log.js"></script>
  
  <link rel="stylesheet" href="./css/styles.css">
  <style>

  </style>
</head>
<body>
  <div class="tab-buttons">
    <div class="tab-left">
      <button onclick="showTab('tab1')" class="active">Circuit Builder</button>
      <button onclick="showTab('tab2')">Cable Groups</button>
      <button onclick="showTab('tab3')">Loads</button>
      <button onclick="showTab('tab4')">EFLI</button>
    </div>
    <div class="tab-info">
    <span>Electrical Calculations v0.1</span>
    </div>
  </div>
    
<!--
      Tab one is where you build you circuit 
-->
  <div id="tab1" class="tab-content active">
      
    <div class="fixed-panel">
      <div id="controls">
        <button onclick="setMode('voltage')">Add Voltage Source</button>
        <button onclick="setMode('conductor')">Add Conductor</button>
        <button onclick="setMode('load')">Add Load</button>
        <button onclick="setMode('connection')">Add Connection</button>
        <button onclick="rotateSelected()">Rotate Selected</button>
        <button onclick="disconnectSelectedNode()">Disconnect Selected</button>
        <button onclick="deleteSelected()">Delete Selected</button>
        <button onclick="calculateCircuitPrep()">Calculate</button>
        <button onclick="toggleResults()">Toggle Results</button>
        <button onclick="getNextUnusedNodeId()">Next Node #</button>
        <button onclick="getNextUnusedComponentId()">Next Component #</button>
        <button onclick="saveConfig()">Save Config</button>
        <input type="file" id="configFile" accept=".json" onchange="loadConfig(event)" style="display: none;">
        <button onclick="document.getElementById('configFile').click()">Load Config</button>
        <button onclick="deleteAll()">Delete All</button>
        <div>
          <label>Voltage (V): <input class=circuit_input id="vMag" type="number" value=""></label>
          <label>Angle (°): <input class=circuit_input id="vAngle" type="number" value=""></label>
        </div>
        <div>
          <label>Resistance (Ω): <input class=circuit_input id="resistance" type="number" value="0"></label>
          <label>Reactance (Ω): <input class=circuit_input id="reactance" type="number" value="0"></label>
        </div>
        <div id="cableSelector">
          <label>Use Group Cable: <input class=cableCheckBox id="cableCheckBox" type="checkbox"></label>
          <select id="cableSelect" disabled>
            <option value="">-- Select --</option>
          </select>
          <label>R(Ω): <input class=circuit_input id="cableR" type="number" value="" disabled></label>
          <label>X(Ω): <input class=circuit_input id="cableX" type="number" value="" disabled></label>
        </div>
        <div id="loadSelector">
          <label>Use Load: <input class=loadCheckBox id="loadCheckBox" type="checkbox"></label>
          <select id="loadSelect" disabled>
            <option value="">-- Select --</option>
          </select>
          <label>R(Ω): <input class=load_input id="loadR" type="number" value="" disabled></label>
          <label>X(Ω): <input class=load_input id="loadX" type="number" value="" disabled></label>
        </div>
      </div>
    </div>
    <div id="canvas-container"></div>
    <script src="js/tab1.js"></script>
    <script src="js/tab1_logic.js"></script>
    <script src="js/config_utils.js"></script>
  </div>

<!--
      Tab two create your cable segments/groups 
-->
  <div id="tab2" class="tab-content">
<!--
        Load up the script files for the AS3008 table data.
-->
    <script src="data/table_34.js"></script>
    <script src="data/table_30.js"></script>
    <script src="js/tab2.js"></script>
    
    <h2>Cable Selection Table</h2>

    <div class="controls">
      <button onclick="CableTab.addCableRow()">Add Cable</button>
      <button onclick="CableTab.deleteCableRows()">Delete Selected</button>
      <button onclick="CableTab.saveConfig()">Save Config</button>
      <input type="file" id="cableConfigLoader" style="display:none;" onchange="CableTab.loadConfig(event)">
      <button onclick="document.getElementById('cableConfigLoader').click()">Load Config</button>
    </div>

    <table id="cableTable">
      <thead>
        <tr>
          <th>Check</th>
          <th>Cable ID</th>
          <th>Description</th>
          <th class="length_input">Length (m)</th>
          <th>Size</th>
          <th>Type</th>
          <th>Temp</th>
          <th>Formation Type</th>
          <th>Insulation</th>
          <th>R(Ω/km)</th>
          <th>X(Ω/km)</th>
          <th>Total R(Ω)</th>
          <th>Total X(Ω)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

  </div>

<!--
      Tab three create your user defined loads with a power and pf calculator 
-->
  <div id="tab3" class="tab-content">
    <h2>Load Selection Table</h2>

    <div class="controls" style="display: flex;">
      <div style="flex: 2;">
        <button onclick="LoadTab.addLoadRow()">Add Load</button>
        <button onclick="LoadTab.deleteCableRows()">Delete Selected</button>
        <button onclick="LoadTab.saveConfig()">Save Config</button>
        <input type="file" id="loadConfigLoader" style="display:none;" onchange="LoadTab.loadConfig(event)">
        <button onclick="document.getElementById('loadConfigLoader').click()">Load Config</button>
      </div>
      <div style="flex: 3; text-align: right;">
        <button onclick="LoadTab.addLoadToTable()">Add Load to Table</button>
        <label>Voltage (V): <input class=load_input id="voltage" type="number" value="230"></label>
        <label>Power (W): <input class=load_input id="power" type="number" value="0"></label>
        <label>Power Factor: <input class=load_input id="power_factor" type="number" value="0.9"></label>
        <label>Resistance (Ω): <input class=load_input id="resistance_2" type="number" value="0" disabled></label>
        <label>Reactance (Ω): <input class=load_input id="reactance_2" type="number" value="0" disabled></label>
      </div>
    </div>

    <table id="loadTable">
      <thead>
        <tr>
          <th class="l_check">Check</th>
          <th class="l_id">Load ID</th>
          <th>Description</th>
          <th class="resistance_th">R(Ω)</th>
          <th class="reactance_th">X(Ω)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    
  </div>
  <script src="js/tab3.js"></script>
  
  <div id="tab4" class="tab-content">
      <h3>Earth Fault Loop Impedance</h3>
      <p align="left">$$ L_{max} = {0.8\cdot U_o\cdot S_{ph}\cdot S_{pe} \over I_a\cdot\rho\cdot(S_{ph}+S_{pe})}
          \Longrightarrow S_{pe} = {L_{max}\cdot I_a\cdot\rho\cdot S_{ph} \over (0.8\cdot U_o\cdot
          S_{ph})-(L_{max}\cdot I_a\cdot\rho)}$$ </p>
      <p>Earth Fault Loop Impedance based on AS 3000 B5.2.2 Calculation method.</p>
      <hr>
      <table id="efliTable" class="efliTable">
          <colgroup>
            <col style="width: 5%;">   <!-- first column (empty or Ia) -->
            <col style="width: 20%;">  <!-- label + input -->
            <col style="width: 2%;">   <!-- arrow -->
            <col style="width: 63%;">  <!-- label + input -->
          </colgroup>
          <tr>
              <td></td>
              <td><label for="lmax">Circuit Length $(m)$:</label><input type="number" id="lmax" name="lamx" value="200" onchange="calculateEFLI()"></td>
              <td class="arrow">$\Longrightarrow$</td>
              <td><label for="mes">$S_{pe}$ Min Earth Size $(mm^2)$:</label><input type="text" id="mes" name="mes" accept-charset="utf-8"  disabled></td>
          </tr>
          <tr>
              <td></td>
              <td><label for="0.8">80% assumed voltage:</label><input type="number" id="0.8" name="0.8" value="0.8" disabled></td>
              <td class="arrow"></td>
              <td><label for="mesxl">$S_{pe}$ Min Earth size /w $X_L (mm^2)$:</label><input type="text" id="mesxl" name="mesxl" accept-charset="utf-8" disabled></td>
          </tr>
          <tr>
              <td></td>
              <td><label for="Uo">Nominal Voltage $U_o$:</label><input type="number" id="Uo" name="Uo" value="230" disabled></td>
              <td class="arrow"></td>
              <td><label for="table5.1">AS3000 Table 5.1 $(mm^2)$:</label><input class="blue" type="text" id="table5.1" name="table5.1" accept-charset="utf-8" disabled></td>
          </tr>
          <tr>
              <td></td>
              <td><label for="SphP">No. $S_{ph}$ condutors in parallel:</label><input type="number" id="SphP" name="SphP" value="1" onchange="calculateEFLI()"></td>
              <td class="arrow"></td>
              <td></td>
          </tr>
          <tr>
              <td></td>
              <td><label for="Sph">Active size $S_{ph} (mm^2)$:</label><input type="number" id="Sph" name="Sph" value="70" onchange="calculateEFLI()"></td>
              <td class="arrow"></td>
              <td><label for="melxl">$L_{max}$ Max Earth Length /w $X_L (m)$:</label><input type="number" id="melxl" name="melxl" disabled></td>
          </tr>
          <tr>
              <td></td>
              <td><label for="Spe">Earth size $S_{pe} (mm^2)$:</label><input type="number" id="Spe" name="Spe" value="25" onchange="calculateEFLI()"></td>
              <td class="arrow">$\Longrightarrow$</td>
              <td><label for="mel">$L_{max}$ Max Earth Length $(m)$:</label><input type="number" id="mel" name="mel" disabled></td>
          </tr>
          <tr>
              <td rowspan="2" style="text-align: right;">$I_a$</td>
              <td><label for="CBsize">CB Size (A):</label><input type="number" id="CBsize" name="CBsize" value="100" onchange="calculateEFLI()"></td>
              <td class="arrow"></td> 
              <td><label for="thr">AS3000 Cl 5.3.3.1.3 $(mm^2)$:</label><input class="blue" type="number" id="thr" name="thr" disabled></td>
          </tr>
          <tr>
              <td><label for="CBtype">CB Type:</label><input title="AS3000:2018 Page 449
  C/B Type B = 4
  C/B Type C = 7.5
  C/B Type D = 12.5

  AS60898.1 Cl 5.3.5
  Type B: 3ln >= 5ln
  Type C: 5ln >= 10ln
  Type D: 10ln >= 20ln" type="number" id="CBtype" name="CBtype" value="4" onchange="calculateEFLI()"></td>
              <td class="arrow"></td>
              <td><label for="kConst">AS3008 K Constant:</label><input title="K Constant is derived from AS3008 Tables 52 & 53" type="number" id="kConst" name="kConst" value="147" onchange="calculateEFLI()"></td>
          </tr>
          <tr>
              <td></td>
              <td><label for="rhoPh">$\rho_{ph}$:</label><select type="number" name="rhoPh" id="rhoPh" onchange="calculateEFLI()">
                      <option value="0.0225">Copper</option>
                      <option value="0.036">Aluminimum</option>
                    </select></td>
              <td class="arrow"></td>
              <td><label for="faultCurrent">Fault current $(A)$:</label></label><input type="number" id="faultCurrent" name="faultCurrent" value="10000" onchange="calculateEFLI()"></td>
          </tr>
          <tr>
              <td></td>
              <td><label for="rhoPe">$\rho_{pe}$:</label><select type="number" name="rhoPe" id="rhoPe" onchange="calculateEFLI()">
                      <option value="0.0225">Copper</option>
                      <option value="0.036">Aluminimum</option>
                    </select></td>
              <td class="arrow"></td>
              <td><label for="disconnectTime">Disconnect Time t $(s)$:</label><input title="AS3000: Cls 5.3.3.1.3
                  Only valid for disconnection times not \< 0.1s and not \> 5s" type="number" id="disCon" name="disCon" value="0.4" onchange="calculateEFLI()"></td>
          </tr>
          <tr>
              <td colspan="4"><label class="unstyled" for="footnote">† A larger earthing conductor may be required to satisfy Clause 5.3.3.1.1.</label>
              
          </tr>
      </table>

  </div>
  <script src="data/cableData.js"></script>
  <script src="js/cookies.js"></script>
  <script src="js/efli.js"></script>
  <script>
    CableTab.init();
    LoadTab.init();
  </script>
</body>
</html>
